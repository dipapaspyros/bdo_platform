{% extends "hcmr_pilot/service_output.html" %}
{% load static %}
{% block css %}
    <style>
        #location_assessment_statistics{ text-align: center;}
        #location_assessment_statistics th{text-align: center; font-weight: 600 !important;}
        #location_assessment_statistics td{text-align: center; }
        #location_assessment_statistics .panel-primary .panel-heading{background-color: #30526a; color: white;}
        #location_assessment_statistics .panel-warning .panel-heading{background-color: #8a6d3b; color: white;}
        #location_assessment_statistics .panel-success .panel-heading{background-color: #3c763d; color: white;}
        #location_assessment_statistics .panel-default .panel-heading{background-color: #707070; color: white;}
    </style>

    <link rel="stylesheet" href="{% static 'hcmr_pilot/css/service_output.css' %}">
{% endblock %}
{% block service_output_results %}
    <h3 style="text-align: center; margin-bottom: 20px;">The evolution of the oil spill in time</h3>
    <div class="container-fluid">
        <div class="container" style="width: 100%; text-align: center;">
            <input value="" id="current_time" class="hidden"/>
            <table id="legend_table" style="width: 100%;">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Initial Volume (m3)</th>
                        <th>Evap. Volume (%)</th>
                        <th>Emuls. Volume (%)</th>
                        <th>Volume on Surface (%)</th>
                        <th>Volume on coasts (%)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="hidden legend_row legend_">-</td>
                        <td class="hidden legend_row legend_">-</td>
                        <td class="hidden legend_row legend_">-</td>
                        <td class="hidden legend_row legend_">-</td>
                        <td class="hidden legend_row legend_">-</td>
                        <td class="hidden legend_row legend_">-</td>
                    </tr>
                    {% for row in legend_data %}
                        <tr>
                            <td class="hidden legend_row legend_{{ row.timestamp }}">{{ row.time }}</td>
                            <td class="hidden legend_row legend_{{ row.timestamp }}">{{ row.init_vol }}</td>
                            <td class="hidden legend_row legend_{{ row.timestamp }}">{{ row.evap_vol }}</td>
                            <td class="hidden legend_row legend_{{ row.timestamp }}">{{ row.emul_vol }}</td>
                            <td class="hidden legend_row legend_{{ row.timestamp }}">{{ row.vol_on_surface }}</td>
                            <td class="hidden legend_row legend_{{ row.timestamp }}">{{ row.vol_on_coasts }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
{#                    <h2 style="text-align: center">Oil Spill Simulation Service Results</h2>#}
{#                    <object type="text/html" data="{{ url }}" width="800px" height="600px"#}
{#                            style="overflow:auto;border:5px ridge blue">#}
{#                    </object>#}

            <div class="viz_container row">
                <div class="frame_container" style="position: relative; height: 100%;">
                    <div class="loadingFrame">
                        <img src="{% static 'img/loading_gif.gif' %}"/>
                    </div>
                    <iframe src="{{ url }}" class=""
                        style="width: 100%; height: 100%; background-color: white;">
                    </iframe>
                </div>
            </div>


            <div>
                <div class="button-container" style="width:100%">
                    <div id="download-out" type="submit" class="btn btn-primary btn-sm btn-default"
                         style="width:30%">
                        <i class="fa fa-download"></i> <a href="/oilspill/download?file={{ out_filepath }}" download style="color:#ffffff">Download Output File</a>
                    </div>
                    <div id="download-report" class="btn btn-primary btn-sm btn-default" style="width:30%" onclick="alert('Currently unavailable')">
                        <i class="fa fa-download"></i> Create & Download Report
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}


{% block  js %}
    <script type="text/javascript">
        $(".viz_container iframe").on( "load", function(){
            $(this).siblings(".loadingFrame").css( "display", "none" )
        });

        $(document).ready(function(){
            function update_current_time(){
              $("#current_time").val($("iframe").contents().find("#current_time").val());
              var current_time = $("#current_time").val();
              $(".legend_row").not(".legend_"+current_time).addClass("hidden");
              $(".legend_"+current_time).removeClass("hidden");
            }
            setInterval(update_current_time,100);
        });
    </script>
{% endblock %}
